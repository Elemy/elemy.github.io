---
title: 对js单线程和异步的理解
date: 2018-04-25
categories: 博客
tags: [js单线程,js异步]
keywords:  js单线程,js异步
---
一直觉得js的单线程和异步是矛盾的，也没有花时间去了解其中的机制，直到最近部门前端组开会，涉及到这个问题，才私下学习其中的原理。
## 浏览器线程
浏览器有多个线程，包括javascript引擎、界面渲染线程、事件触发线程、http请求线程。

![image](https://github.com/Elemy/elemy.github.io/raw/master/images/brower-threads.png)
## javascript线程
#### 1. 事件循环

JS 会创建一个类似于 while (true) 的循环，每执行一次循环体的过程称之为 Tick。每次 Tick 的过程就是查看是否有待处理事件，如果有则取出相关事件及回调函数放入执行栈中由主线程执行。待处理的事件会存储在一个任务队列中，也就是每次 Tick 会查看任务队列中是否有需要执行的任务。
#### 2. 任务队列

异步操作会将相关回调添加到任务队列中。而不同的异步操作添加到任务队列的时机也不同，如 onclick, setTimeout, ajax 处理的方式都不同，这些异步操作是由浏览器内核的 webcore 来执行的，webcore 包含上图中的3种 webAPI，分别是 DOM Binding、network、timer模块。
#### 3. 主线程

JS 只有一个线程，称之为主线程。而事件循环是主线程中执行栈里的代码执行完毕之后，才开始执行的。所以，主线程中要执行的代码时间过长，会阻塞事件循环的执行，也就会阻塞异步操作的执行。只有当主线程中执行栈为空的时候（即同步代码执行完后），才会进行事件循环来观察要执行的事件回调，当事件循环检测到任务队列中有事件就取出相关回调放入执行栈中由主线程执行。
#### 4. js线程与GUI线程是互斥的。

当GUI在执行的时候，js线程会被阻塞；当js线程在执行任务的时候，GUI会被“冻结”。
#### 5. ajax异步。
    
ajax的异步是由浏览器http请求线程实现的。浏览器监测到请求状态变更，会将先前已设置好的回调函数放到js单线程任务队列中等待处理。

> *学习文章：
[https://blog.csdn.net/qdq2014/article/details/72383725](https://blog.csdn.net/qdq2014/article/details/72383725)*
